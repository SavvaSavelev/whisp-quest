# Whisp Quest Server v2.0 üöÄ - –ò–¢–û–ì–û–í–ê–Ø –†–ï–í–ò–ó–ò–Ø

## üìä –§–ò–ù–ê–õ–¨–ù–´–ô –°–¢–ê–¢–£–° –°–ò–°–¢–ï–ú–´

‚úÖ **–í–°–ï –ö–û–ú–ü–û–ù–ï–ù–¢–´ –†–ê–ë–û–¢–ê–Æ–¢ –ö–û–†–†–ï–ö–¢–ù–û**
- ‚úÖ OpenAI API: –ü–æ–¥–∫–ª—é—á–µ–Ω (164 —Å–∏–º–≤–æ–ª–∞)
- ‚úÖ –ü–æ—Ä—Ç 3001: –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –§—Ä–æ–Ω—Ç–µ–Ω–¥ 5173: –ü–æ–¥–∫–ª—é—á–µ–Ω –∫ —Å–µ—Ä–≤–µ—Ä—É
- ‚úÖ –í—Å–µ endpoints: –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã
- ‚úÖ –î—É—Ö–∏: –°–æ–∑–¥–∞—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ, —Ä–µ–∞–≥–∏—Ä—É—é—Ç –Ω–∞ —Ç–µ–∫—Å—Ç
- ‚úÖ –ß–∞—Ç: –°–∞—Ä–∫–∞—Å—Ç–∏—á–Ω—ã–π –∏ –∂–∏–≤–æ–π
- ‚úÖ –°–ø–ª–µ—Ç–Ω–∏: –†–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

## üéØ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø V2.0

### 1. –ê–ù–ê–õ–ò–ó –î–£–•–û–í (/analyze)
**–ë—ã–ª–æ:** –î—É—Ö–∏ –≤—Å–µ–≥–¥–∞ "–ù–ï–û–ü–û–ó–ù–ê–ù–ù–ê–Ø –°–£–©–ù–û–°–¢–¨", –≥—Ä—É—Å—Ç–Ω—ã–µ
**–°—Ç–∞–ª–æ:** 
```json
{
  "mood": "–∑–ª–æ–π",           // –†–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ —Ç–µ–∫—Å—Ç
  "color": "#ff0000",       // –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Ü–≤–µ—Ç–∞
  "rarity": "—Ä–µ–¥–∫–∏–π",       // –†–∞–∑–Ω–∞—è —Ä–µ–¥–∫–æ—Å—Ç—å  
  "essence": "–≥–Ω–µ–≤–Ω–∞—è —Ç–µ–Ω—å", // –ü–æ—ç—Ç–∏—á–Ω—ã–µ –∏–º–µ–Ω–∞
  "dialogue": "–ù—É —á—Ç–æ, –¥–µ—Ä–∑–∫–∏–π —Å–º–µ—Ä—Ç–Ω—ã–π..." // –ö–æ–ª–∫–∏–µ —Ä–µ–ø–ª–∏–∫–∏
}
```

### 2. –ü–û–†–¢–´ (–£–ù–ò–§–ò–ö–ê–¶–ò–Ø)
–ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –í–°–ï —Ñ–∞–π–ª—ã —Å 4000 ‚Üí 3001:
- ‚úÖ `spiritGossip.ts`
- ‚úÖ `generateGossip.ts` 
- ‚úÖ `spiritChat.ts`
- ‚úÖ `APIClient.ts`

### 3. –°–¢–ò–õ–¨ –î–£–•–û–í
**–ë—ã–ª–æ:** –ú–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ, —Ñ–æ—Ä–º–∞–ª—å–Ω—ã–µ
**–°—Ç–∞–ª–æ:** 
- –°–∞—Ä–∫–∞—Å—Ç–∏—á–Ω—ã–µ —Å —á—ë—Ä–Ω—ã–º —é–º–æ—Ä–æ–º
- –ö–æ–ª–∫–∏–µ –∏ –∂–∏–≤—ã–µ
- –ú–∞—Ç–µ—Ä–∏—Ç—å—Å—è, –Ω–æ –Ω–µ –ø–µ—Ä–µ–±–∞—Ä—â–∏–≤–∞—Ç—å
- –ü–æ–¥–∫–∞–ª—ã–≤–∞—é—Ç —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞

### 4. SPIRIT-GOSSIP –°–¢–†–£–ö–¢–£–†–ê
**–ë—ã–ª–æ:** `{topic, mood, length}` ‚Üí `{gossip}`
**–°—Ç–∞–ª–æ:** `{from: spirit, to: spirit}` ‚Üí `{question, answer}`

## üîß –ê–†–•–ò–¢–ï–ö–¢–£–†–ê –°–ï–†–í–ï–†–ê

### –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª: `server-optimized.js` (16.7KB)
```javascript
// Endpoints:
GET  /                    // –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
GET  /health             // –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
GET  /health/detailed    // –ü–æ–¥—Ä–æ–±–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
POST /analyze           // –°–æ–∑–¥–∞–Ω–∏–µ –¥—É—Ö–æ–≤
POST /spirit-chat       // –ß–∞—Ç —Å –¥—É—Ö–∞–º–∏  
POST /spirit-gossip     // –°–ø–ª–µ—Ç–Ω–∏ –¥—É—Ö–æ–≤
```

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:
- Helmet.js (–∑–∞—â–∏—Ç–∞ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤)
- Rate limiting (100/15–º–∏–Ω, 20 —á–∞—Ç–æ–≤/—á–∞—Å)
- CORS (–Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ origins)
- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- XSS –∑–∞—â–∏—Ç–∞

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
- In-memory –∫—ç—à (5 –º–∏–Ω TTL)
- –ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ 
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π OpenAI –∫–ª–∏–µ–Ω—Ç
- Graceful shutdown

## üìà –õ–û–ì–ò –†–ê–ë–û–¢–´

```bash
üöÄ –ó–∞–ø—É—Å–∫ Whisp Quest Server v2.0...
üîë OpenAI API Key: ‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω (164 —Å–∏–º–≤–æ–ª–æ–≤)
‚úÖ Whisp Quest Server v2.0 –∑–∞–ø—É—â–µ–Ω!
üîç –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—Å—Ç–∞ (20 —Å–∏–º–≤–æ–ª–æ–≤)
‚úÖ –ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω: –∑–ª–æ–π –¥—É—Ö "–≥–Ω–µ–≤–Ω–∞—è —Ç–µ–Ω—å"
üí¨ –ß–∞—Ç —Å –¥—É—Ö–æ–º: "–Ω—É —á—Ç–æ ?..."
‚úÖ –î—É—Ö –æ—Ç–≤–µ—Ç–∏–ª: "–ù—É —á—Ç–æ, –¥–µ—Ä–∑–∫–∏–π —Å–º–µ—Ä—Ç–Ω—ã–π..."
üó£Ô∏è –°–ø–ª–µ—Ç–Ω—è –º–µ–∂–¥—É "–≥–Ω–µ–≤–Ω–∞—è —Ç–µ–Ω—å" –∏ "—Å–æ–ª–Ω–µ—á–Ω—ã–π –ª—É—á"
‚úÖ –°–ø–ª–µ—Ç–Ω—è —Å–æ–∑–¥–∞–Ω–∞: "–ß—Ç–æ –¥—É–º–∞–µ—à—å..." -> "–î—É–º–∞—é, –µ–º—É –Ω—É–∂–Ω–æ..."
```

## üéõÔ∏è –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø

### –§–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞:
```
whisp-server/
‚îú‚îÄ‚îÄ server-optimized.js ‚úÖ MAIN (16.7KB)
‚îú‚îÄ‚îÄ .env               ‚úÖ OpenAI –∫–ª—é—á (164 —Å–∏–º–≤–æ–ª–∞)
‚îú‚îÄ‚îÄ .gitignore         ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç —É—Ç–µ—á–µ–∫
‚îú‚îÄ‚îÄ package.json       ‚úÖ v2.0.0
‚îú‚îÄ‚îÄ README.md          ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îî‚îÄ‚îÄ node_modules/      ‚úÖ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env):
```env
OPENAI_API_KEY=sk-proj-xxx...xxx ‚úÖ –†–ê–ë–û–ß–ò–ô
PORT=3001                        ‚úÖ –ê–ö–¢–ò–í–ù–´–ô
NODE_ENV=development            ‚úÖ –ù–ê–°–¢–†–û–ï–ù
```

## üîç –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

### Health Check:
```bash
curl http://localhost:3001/health
# StatusCode: 200 ‚úÖ
# Content: {"status":"ok","uptime":683,"memory":{...},"openai_configured":true}
```

### –°–æ–∑–¥–∞–Ω–∏–µ –¥—É—Ö–∞:
```json
POST /analyze {"text": "—è –∑–ª–æ–π"}
‚Üí {"mood": "–∑–ª–æ–π", "essence": "–≥–Ω–µ–≤–Ω–∞—è —Ç–µ–Ω—å", "dialogue": "–ù—É —á—Ç–æ, –¥–µ—Ä–∑–∫–∏–π..."}
```

### –ß–∞—Ç —Å –¥—É—Ö–æ–º:
```json
POST /spirit-chat {"text": "–ø—Ä–∏–≤–µ—Ç", "mood": "–∑–ª–æ–π", "essence": "–≥–Ω–µ–≤–Ω–∞—è —Ç–µ–Ω—å"}
‚Üí {"reply": "–û–≥–æ, –∫–∞–∫–æ–π –∫—É–ª—å—Ç—É—Ä–Ω—ã–π –æ–±–æ—Ä–æ—Ç, –º–æ–π —É–≤–∞–∂–∞–µ–º—ã–π –≥—Ä—É–±–∏—è–Ω!"}
```

## üìã –ò–¢–û–ì–û–í–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´

### ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û:
1. –î—É—Ö–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏ (–Ω–µ "–ù–ï–û–ü–û–ó–ù–ê–ù–ù–ê–Ø –°–£–©–ù–û–°–¢–¨")
2. –í—Å–µ –ø–æ—Ä—Ç—ã —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞ 3001
3. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —Å–∞—Ä–∫–∞—Å—Ç–∏—á–Ω—ã–π —Å—Ç–∏–ª—å –æ–±—â–µ–Ω–∏—è
4. Spirit-gossip —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π
5. –£–±—Ä–∞–Ω—ã –≤—Å–µ –æ—à–∏–±–∫–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞

### ‚úÖ –î–û–ë–ê–í–õ–ï–ù–û:
1. –ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (Helmet, Rate limiting)
2. In-memory –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫–æ–π
3. –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —ç–º–æ–¥–∑–∏
4. Health checks –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
5. Graceful shutdown –∏ error handling

### ‚úÖ –û–ü–¢–ò–ú–ò–ó–ò–†–û–í–ê–ù–û:
1. –ï–¥–∏–Ω—ã–π —Ñ–∞–π–ª —Å–µ—Ä–≤–µ—Ä–∞ (16.7KB)
2. –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ OpenAI
3. –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏
4. –ë—ã—Å—Ç—Ä—ã–µ –æ—Ç–≤–µ—Ç—ã –±–ª–∞–≥–æ–¥–∞—Ä—è –∫—ç—à—É

## üöÄ –ì–û–¢–û–í–ù–û–°–¢–¨ –ö –†–ê–ë–û–¢–ï

**–°–µ—Ä–≤–µ—Ä:** `http://localhost:3001` ‚úÖ –†–ê–ë–û–¢–ê–ï–¢  
**–§—Ä–æ–Ω—Ç–µ–Ω–¥:** `http://localhost:5173/whisp-quest/` ‚úÖ –ü–û–î–ö–õ–Æ–ß–ï–ù  
**OpenAI:** –ê–∫—Ç–∏–≤–µ–Ω –∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç—ã ‚úÖ  

### –ö–æ–º–∞–Ω–¥—ã –∑–∞–ø—É—Å–∫–∞:
```bash
# –°–µ—Ä–≤–µ—Ä
cd whisp-server
npm start

# –§—Ä–æ–Ω—Ç–µ–Ω–¥  
cd ../
npm run dev
```

## üèÜ –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

**Whisp Quest Server v2.0 –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!**

–í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã:
- ‚ùå "–ù–ï–û–ü–û–ó–ù–ê–ù–ù–ê–Ø –°–£–©–ù–û–°–¢–¨" ‚Üí ‚úÖ –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞ –¥—É—Ö–æ–≤
- ‚ùå –û—à–∏–±–∫–∏ –ø–æ—Ä—Ç–æ–≤ 4000 ‚Üí ‚úÖ –ï–¥–∏–Ω—ã–π –ø–æ—Ä—Ç 3001  
- ‚ùå –§–æ—Ä–º–∞–ª—å–Ω—ã–µ –¥—É—Ö–∏ ‚Üí ‚úÖ –°–∞—Ä–∫–∞—Å—Ç–∏—á–Ω—ã–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∏
- ‚ùå –ù–µ—Ä–∞–±–æ—Ç–∞—é—â–∏–µ —Å–ø–ª–µ—Ç–Ω–∏ ‚Üí ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π API

–°–µ—Ä–≤–µ—Ä –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω, –±–µ–∑–æ–ø–∞—Å–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ production –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é! üéâ
